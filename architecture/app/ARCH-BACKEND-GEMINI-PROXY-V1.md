---
id: ARCH-BACKEND-GEMINI-PROXY
title: "Бэкенд. Прокси для потокового API Google Gemini"
type: component
layer: infrastructure
owner: '@unassigned'
version: v1
status: planned
created: 2025-09-03
updated: 2025-09-03
tags: [backend, go, gemini, api, streaming]
depends_on: []
referenced_by: []
---
## Контекст
Этот компонент является ключевым элементом бэкенда, обеспечивающим безопасное и эффективное взаимодействие с Google AI API. Его главная задача — выступать в роли прокси-сервера, который управляет API-ключом пользователя и транслирует потоковые ответы от модели Gemini на фронтенд в реальном времени.

## Структура
Компонент будет реализован в `app.go` с использованием Go-библиотеки `github.com/google/generative-ai-go/genai`.
- **Публичные функции:**
  - `CommunicateWithGoogleAI(request ChatRequest)`: Основная функция, инициирующая потоковый чат с Gemini.
  - `SaveApiKey(key string)` / `LoadApiKey()`: Функции для безопасного хранения и извлечения API-ключа пользователя из файла конфигурации.
- **Внутренняя логика:**
  - Обработка HTTP-запросов к Google AI API.
  - Управление жизненным циклом потокового соединения.
  - Использование системы событий Wails (`EventsEmit`) для отправки фрагментов данных (`newChunk`) на фронтенд.

## Поведение
1.  **Управление ключом**: API-ключ пользователя хранится в файле `config.json` в домашней директории пользователя и никогда не передается на фронтенд. Все запросы к Google API подписываются этим ключом на стороне бэкенда.
2.  **Потоковая трансляция**: При вызове `CommunicateWithGoogleAI` бэкенд устанавливает соединение `GenerateContentStream` с моделью `gemini-2.5-pro-latest`.
3.  **Цикл обработки**: В цикле бэкенд считывает каждый фрагмент ответа из потока.
4.  **Отправка событий**: Каждый полученный фрагмент немедленно отправляется на фронтенд через событие Wails `newChunk`. По завершении или в случае ошибки отправляются события `streamEnd` или `streamError`.

## Эволюция
### Планируется
- Добавление поддержки других моделей Gemini.
- Реализация кэширования для повторяющихся запросов.

### История
- v1: Первоначальный дизайн, сфокусированный на безопасности API-ключа и потоковой передаче данных для модели `gemini-2.5-pro-latest`.

