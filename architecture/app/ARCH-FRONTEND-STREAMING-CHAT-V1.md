---
id: ARCH-FRONTEND-STREAMING-CHAT
title: "Фронтенд. Компонент потокового чата"
type: component
layer: presentation
owner: '@unassigned'
version: v1
status: planned
created: 2025-09-03
updated: 2025-09-03
tags: [frontend, vue, chat, streaming, gemini]
depends_on: [ARCH-BACKEND-GEMINI-PROXY]
referenced_by: []
---
## Контекст
Этот компонент реализует полнофункциональный чат-интерфейс на Шаге 3 рабочего процесса. Он предназначен для итеративного взаимодействия пользователя с AI-моделью Gemini в режиме реального времени, позволяя дорабатывать и уточнять промпты перед их финальным применением.

## Структура
Компонент `Step3Chat.vue` будет реализован на Vue.js.
- **Состояние (State)**:
  - `messageHistory`: массив объектов сообщений (от пользователя и AI).
  - `currentStreamContent`: строка, в которую добавляются фрагменты ответа AI.
  - `isLoading`: boolean, флаг ожидания ответа.
  - `modelParams`: объект с параметрами, такими как `temperature` и `thinkingBudget`.
- **Логика**:
  - **Подписка на события**: При монтировании компонент подписывается на события Wails: `newChunk`, `streamEnd`, `streamError`.
  - **Обработчики событий**:
    - `onNewChunk`: добавляет полученные данные к `currentStreamContent`.
    - `onStreamEnd`: переносит `currentStreamContent` в `messageHistory` как завершенное сообщение.
    - `onStreamError`: отображает сообщение об ошибке.
  - **Отправка сообщения**: При отправке формы вызывается бэкенд-функция `CommunicateWithGoogleAI`, передавая историю чата и параметры модели.

## Поведение
1.  **Отображение в реальном времени**: Когда пользователь отправляет сообщение, компонент вызывает бэкенд. Бэкенд начинает транслировать события `newChunk`. UI компонента в реальном времени обновляет область ответа AI, создавая эффект "печатания".
2.  **Управление параметрами**: UI предоставляет элементы управления для `temperature` и `thinkingBudget`. Для `thinkingBudget` реализована условная логика: "Динамический" режим (значение зависит от роли) и "Ручной" (слайдер).
3.  **История диалога**: Весь диалог сохраняется в `messageHistory` и отображается пользователю. Предусмотрена возможность скопировать любое сообщение из истории.

## Эволюция
### Планируется
- Добавление возможности редактировать предыдущие сообщения.
- Поддержка загрузки файлов в чат.

### История
- v1: Первоначальный дизайн, ориентированный на потоковое отображение текста и базовое управление параметрами модели.

